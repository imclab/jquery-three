window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}(),function(e){var t={};Three=function(r,i,a){var n=this;this.container=r,this.options=e.extend(t,i),this.objects={},this.scenes={},this.cameras={},this.last=!1,this.parent=!1,e.getScript("http://cdnjs.cloudflare.com/ajax/libs/three.js/r53/three.min.js",function(){n.init(i),a!==void 0&&a(n)})},Three.prototype={init:function(r){var i=this;e.extend(t,r),this.active={scene:!1,camera:!1,skybox:!1},this.properties=this.setProperties(),this.renderer=new THREE.WebGLRenderer,this.renderer.setSize(this.properties.width,this.properties.height),this.renderer.autoClear=!1;var a=e(this.container).html();e(this.container).html("<shadow-root></shadow-root>"),this.parent=e(this.container).find("shadow-root"),this.html(a),e(this.renderer.domElement).appendTo(this.container),window.addEventListener("resize",function(){i.resize()},!1),this.tick()},destroy:function(){return this.each(function(){var t=e(this);t.data("three"),t.removeData("three")})},self:function(t,r){var i=[];return this.each(function(){var a=e(this),n=a.data("three");n||(n=new Three(this,t,r),e(this).data("three",n)),i.push(n)}),e(i)},tick:function(){var e=this;this.render(),requestAnimFrame(function(){e.tick()})},render:function(){e(this.container).trigger({type:"update",target:this}),this.active.scene&&this.active.camera&&(this.active.skybox&&(this.active.skybox.camera.rotation.copy(this.active.camera.rotation),this.renderer.render(this.active.skybox.scene,this.active.skybox.camera)),this.renderer.render(this.active.scene,this.active.camera))},show:function(){},hide:function(){},update:function(){},detect:function(){return{canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(e){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,all:function(){return this.webgl&&this.canvas&&this.workers&&this.fileapi}}},resize:function(){this.properties=this.setProperties();for(var e in this.cameras)this.cameras[e].aspect=this.properties.aspect,this.cameras[e].updateProjectionMatrix(),this.active.skybox.aspect=this.properties.aspect,this.active.skybox.updateProjectionMatrix();this.renderer.setSize(this.properties.width,this.properties.height)}},e.fn.three=function(e,t){return e||(e=!1),t||(t=function(e){return e}),Three.prototype.self.apply(this,arguments,e,t)}}(jQuery),function(e){Three.prototype=e.extend(Three.prototype,{addClass:function(t){var r=this.last,i=e(this.container).find("[data-id='"+r.id+"']");i.addClass(t);var a=this.css(i);return this.cssSet(a),this}})}(jQuery),function(e){Three.prototype=e.extend(Three.prototype,{css:function(t){var r=document.styleSheets,i={};for(var a in r){var n=r[a].rules||r[a].cssRules;for(var s in n)t.is(n[s].selectorText)&&(i=e.extend(i,this.css2json(n[s].style),this.css2json(t.attr("style"))))}return i},cssSet:function(e){var t=this.last;if(t)for(var r in e){var i=r.replace("-webkit-","").replace("-moz-","");switch(i){case"width":t.scale.x=parseInt(e[r],10);break;case"height":t.scale.y=parseInt(e[r],10);break;case"top":t.position.y=parseInt(e[r],10);break;case"left":t.position.x=parseInt(e[r],10);break;case"color":var a=this.colorToHex(e[r]);t.material.color.setHex(a);break;case"transform":e[r].search("translate3d")>-1&&(t.position=this.cssTranslate(e[r])),e[r].search("rotate3d")>-1&&(t.rotation=this.cssRotate(e[r]));break;case"animation-duration":console.log(i,e[r]);break;case"animation-timing":console.log(i,e[r]);break;case"animation-delay":console.log(i,e[r]);break;case"animation-iteration-count":console.log(i,e[r]);break;case"animation-direction":console.log(i,e[r]);break;case"animation-fill-mode":console.log(i,e[r]);break;case"animation-name":console.log(i,e[r]);break;case"display":break;case"background-image":t instanceof THREE.Scene&&this.cssSkybox(e[r]),"terrain"==t.type&&this.cssTerrain(e[r])}}},cssSkybox:function(e){var t=e.replace(/\s|url\(|\)/g,"").split(",");t instanceof Array&&this.addSkybox(t)},cssTerrain:function(e){var t=this.last,r=e.replace(/\s|url\(|\)/g,"").split(",");if(r instanceof Array)for(var i in r){if(r[i].search("heightmap")>-1){var a=THREE.ImageUtils.loadTexture(r[i]);t.material.uniforms.tDisplacement.value=a,t.material.uniforms.uDisplacementScale.value=375;var n=a;n.wrapS=n.wrapT=THREE.RepeatWrapping,t.material.uniforms.tDiffuse2.value=n,t.material.uniforms.enableDiffuse2.value=!0}if(r[i].search("diffuse")>-1){var s=THREE.ImageUtils.loadTexture(r[i]);s.wrapS=s.wrapT=THREE.RepeatWrapping,t.material.uniforms.tDiffuse1.value=s,t.material.uniforms.enableDiffuse1.value=!0}if(r[i].search("specular")>-1){var o=THREE.ImageUtils.loadTexture(r[i]);o.wrapS=o.wrapT=THREE.RepeatWrapping,t.material.uniforms.tSpecular.value=o,t.material.uniforms.enableSpecular.value=!0}}},cssTranslate:function(e){var t={};if(e.search("translate3d")>-1){var r=e.match(/translate3d\(([\s\S]*?)\)/gi);r=r[0].replace(/translate3d\(|px|\)| /gi,"").split(","),t={x:parseInt(r[0],10)||0,y:parseInt(r[1],10)||0,z:parseInt(r[2],10)||0}}return t},cssRotate:function(e){var t={};if(e.search("rotate3d")>-1){var r=e.match(/rotate3d\(([\s\S]*?)\)/gi);r=r[0].replace(/rotate3d\(|deg|\)| /gi,"").split(","),t={x:parseInt(r[0],10)?parseInt(r[3],10):0,y:parseInt(r[1],10)?parseInt(r[3],10):0,z:parseInt(r[2],10)?parseInt(r[3],10):0}}return t},css2json:function(e){var t={};if(!e)return t;if(e instanceof CSSStyleDeclaration)for(var r in e)e[r].toLowerCase&&(t[e[r].toLowerCase()]=e[e[r]]);else if("string"==typeof e){e=e.split("; ");for(var i in e){var a=e[i].split(": ");t[a[0].toLowerCase()]=a[1]}}return t}})}(jQuery),function(e){Three.prototype=e.extend(Three.prototype,{animate:function(){}})}(jQuery),function(e){Three.prototype=e.extend(Three.prototype,{})}(jQuery),function(e){Three.prototype=e.extend(Three.prototype,{add:function(e){if(e===void 0||e.type===void 0)return this;var t=this.webgl(e);e["data-id"]=t.id||!1;var r=this.createHTML(e);this.last=t;var i=this.css(r);return this.cssSet(i),this.active[e.type]=t,this},addScene:function(e){var t=e||{};return t.type="scene",this.add(t),this},addPlane:function(e){var t=e||{};return t.type="plane",this.add(t),this},addCamera:function(e){var t=e||{};return t.type="camera",this.add(t),this},addMesh:function(e){var t=e||{};return t.type="mesh",this.add(t),this},addAsset:function(e){var t=e||{};return t.type="asset",this.add(t),this},addSkybox:function(t){var r=new THREE.PerspectiveCamera(50,e(this.container).width()/e(this.container).height(),1,100),i=new THREE.Scene,a=THREE.ImageUtils.loadTextureCube(t);a.format=THREE.RGBFormat;var n=THREE.ShaderUtils.lib.cube;n.uniforms.tCube.value=a;var s=new THREE.ShaderMaterial({fragmentShader:n.fragmentShader,vertexShader:n.vertexShader,uniforms:n.uniforms,depthWrite:!1,side:THREE.BackSide});mesh=new THREE.Mesh(new THREE.CubeGeometry(100,100,100),s),i.add(mesh),this.active.skybox={scene:i,camera:r}},addTerrain:function(e){var t=e||{};return t.type="terrain",this.add(t),this}})}(jQuery),function(e){Three.prototype=e.extend(Three.prototype,{html:function(t){var r=this,i={};e(t).filter("*").each(function(t,a){var n=a===void 0?!1:e(a);if(n){i.type=a.nodeName.toLowerCase(),i.id=n.attr("id");var s=r.getAttributes(a);i=e.extend(i,s),r.add(i),r.html(n.html())}})},createHTML:function(t){var r=e("<"+t.type+">");return t.id&&r.attr("id",t.id),t["data-id"]&&r.attr("data-id",t["data-id"]),r.appendTo(this.parent),this.parent=r,r}})}(jQuery),function(e){Three.prototype=e.extend(Three.prototype,{})}(jQuery),function(e){Three.prototype=e.extend(Three.prototype,{webgl:function(e){var t;switch(e.type){case"scene":t=this.webglScene(e);break;case"camera":t=this.webglCamera(e);break;case"mesh":t=this.webglMesh(e);break;case"light":t=this.webglLight(e);break;case"plane":t=this.webglPlane(e);break;case"terrain":t=this.webglTerrain(e)}return t},webglScene:function(t){var r={id:!1};e.extend(r,t);var i=new THREE.Scene;return i},webglCamera:function(t){var r,i={fov:50,aspect:this.properties.aspect,near:1,far:1e3,scene:this.active.scene},a=e.extend(i,t);return a.orthographic||(r=new THREE.PerspectiveCamera(a.fov,a.aspect,a.near,a.far)),r},webglMesh:function(t){var r,i={id:!1,scene:this.active.scene};return e.extend(i,t),r},webglLight:function(){},webglPlane:function(t){var r={width:1,height:1,color:0,scene:this.active.scene},i=e.extend(r,t),a=new THREE.PlaneGeometry(i.width,i.height);a.dynamic=!0;var n=new THREE.MeshBasicMaterial({color:i.color}),s=new THREE.Mesh(a,n);return i.id&&(s.name=id),this.objects[s.id]=s,i.scene.add(s),s},webglSphere:function(t){var r={id:!1,radius:1,segments:16,rings:16,color:0,scene:this.active.scene},i=e.extend(r,t),a=new SphereGeometry(i.radius,i.segments,i.rings);a.dynamic=!0;var n=new THREE.MeshBasicMaterial({color:i.color}),s=new THREE.Mesh(a,n);return i.id&&(s.name=id),this.objects[s.id]=s,i.scene.add(s),s},webglCube:function(t){var r={id:!1,width:1,height:1,depth:1,color:0,scene:this.active.scene},i=e.extend(r,t),a=new CubeGeometry(i.width,i.height,i.depth);a.dynamic=!0;var n=new THREE.MeshBasicMaterial({color:i.color}),s=new THREE.Mesh(a,n);return i.id&&(s.name=id),this.objects[s.id]=s,i.scene.add(s),s},webglCylinder:function(t){var r={id:!1,radiusTop:100,radiusBottom:100,segmentsRadius:400,segmentsHeight:50,openEnded:50,color:0,scene:this.active.scene},i=e.extend(r,t),a=new CylinderGeometry(i.radiusTop,i.radiusBottom,i.segmentsRadius,i.segmentsHeight,i.openEnded,!1);a.dynamic=!0;var n=new THREE.MeshBasicMaterial({color:i.color}),s=new THREE.Mesh(a,n);return i.id&&(s.name=id),this.objects[s.id]=s,i.scene.add(s),s},webglTerrain:function(){var e;this.active.scene.add(new THREE.AmbientLight(1118481)),directionalLight=new THREE.DirectionalLight(16777215,1.15),directionalLight.position.set(500,2e3,0),this.active.scene.add(directionalLight);var t=new THREE.PlaneGeometry(6e3,6e3,256,256);t.computeFaceNormals(),t.computeVertexNormals(),t.computeTangents();var r=THREE.ShaderTerrain.terrain;uniformsTerrain=THREE.UniformsUtils.clone(r.uniforms),uniformsTerrain.uDiffuseColor.value.setHex(16777215),uniformsTerrain.uSpecularColor.value.setHex(16777215),uniformsTerrain.uAmbientColor.value.setHex(1118481),uniformsTerrain.uRepeatOverlay.value.set(6,6);var i=new THREE.ShaderMaterial({uniforms:uniformsTerrain,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,lights:!0,fog:!1});return e=new THREE.Mesh(t,i),e.type="terrain",this.active.scene.add(e),e}})}(jQuery),function(e){Three.prototype=e.extend(Three.prototype,{colorToHex:function(e){if("#"===e.substr(0,1))return e.replace("#","0x");var t=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(e),r=parseInt(t[2],10).toString(16),i=parseInt(t[3],10).toString(16),a=parseInt(t[4],10).toString(16);return 1==r.length&&(r="0"+r),1==i.length&&(i="0"+i),1==a.length&&(a="0"+a),"0x"+r+i+a},getAttributes:function(e){var t=document.createElement("div");t.innerHTML=e;var r=t.firstChild,i=r.attributes,a={};for(var n in i)if(i[n].name&&0===i[n].name.search("data-")){var s=i[n].name.replace("data-",""),o=i[n].value;a[s]=parseInt(o,10)?parseInt(o,10):o}return a},setProperties:function(){return{width:e(this.container).width(),height:e(this.container).height(),aspect:e(this.container).width()/e(this.container).height()}}})}(jQuery);